/* ==================================================
  ** outline-item
  type: object

  This is a unicorn component built for the SortableTree/Product-Outline
  React component within Kajabi-Products. The current implementation
  uses the raw css classes defined here rather than using a SageReact
  component. This was done because the logic governing dragging & sorting
  is tightly knit to the class modifiers provided in this file. A refactor
  to a SageReact component is targeted at the end of this cycle. However, until
  we can account for the entire featureset required for the Product Outline, we
  consider a SageReact component premature optimization.

  Component Owner: Product-Build UXD

================================================== */

$-collapse-breakpoint-key: md-max;

.sage-outline-item {
  display: grid;
  align-items: center;
  grid-template-rows: repeat(auto-fit, auto);
  grid-column-gap: sage-spacing(xs);
  background: sage-color(white);
  will-change: background, box-shadow;

  // NOTE: Height is governed by a parent React node to allow us
  //       to dynamically adjust the height of elements depending
  //       on the size of the dataset provided. If the dataset
  //       is large we 'normalize' all of the node heights to
  //       allow them to be predictably virtualized in a shodow
  //       DOM when not visible. This prevents browser lag. For
  //       small datasets, Categories have a larger height than
  //       regular Outline Items
  //
  // stylelint-disable order/properties-order
  height: 100%;
  max-height: rem(80px);
  // stylelint-enable order/properties-order

  @media (min-width: sage-breakpoint($-collapse-breakpoint-key)) {
    // Using static column values to ensure alignment
    grid-template-columns: min-content 1fr min-content rem(160px) rem(92px) rem(40px);
    grid-template-areas: "handle-drag title actions-secondary actions-primary status handle-collapse";
  }

  @media (max-width: sage-breakpoint($-collapse-breakpoint-key)) {
    grid-template-columns: min-content 1fr min-content min-content;
    grid-row-gap: sage-spacing(2xs);
    grid-template-areas:
      "handle-drag title actions-secondary status"
      ". actions-primary . handle-collapse";
  }

  &:not(.sage-outline-item--category) {
    border-bottom: sage-border(light);
  }

  &.sage-outline-item--category {
    border-bottom: sage-border();
  }

  &.sage-outline-item--is-dragging {
    border: unset;
    box-shadow: inset 0 0 0 1px sage-color(white), inset 0 0 0 2px sage-color(grey, 300);

    // NOTE: Forces hardware acceleration, this resolves issue with HTML5 Drag & Drop
    //       API drag-preview 'capture' action in webkit browsers.
    //
    // stylelint-disable-next-line order/properties-order
    transform: translateZ(0);

    .sage-outline-item__actions-primary,
    .sage-outline-item__actions-secondary,
    .sage-outline-item__handle-collapse {
      visibility: hidden;
    }
  }

  &.sage-outline-item--is-dragging-descendant {
    border: unset;
    box-shadow: inset 0 0 0 1px sage-color(white), inset 0 0 0 2px sage-color(grey, 300);

    .sage-outline-item__actions-primary,
    .sage-outline-item__actions-secondary,
    .sage-outline-item__handle-collapse {
      visibility: hidden;
    }

    > * {
      opacity: 0.5;
    }
  }

  &.sage-outline-item--is-droptarget {
    border-radius: sage-border(radius-large);
    box-shadow: inset 0 0 0 1px sage-color(white), inset 0 0 0 2px sage-color(primary), inset 0 0 0 5px sage-color(white);
    background: repeating-linear-gradient(
      45deg,
      sage-color(grey, 300) 0,
      sage-color(grey, 300) 12px,
      sage-color(white) 12px,
      sage-color(white) 24px
    );

    > * {
      visibility: hidden;
    }
  }

  &.sage-outline-item--is-droptarget-invalid {
    border-radius: sage-border(radius-large);
    box-shadow: inset 0 0 0 1px sage-color(white), inset 0 0 0 2px sage-color(red, 200), inset 0 0 0 5px sage-color(white);
    background: repeating-linear-gradient(
      45deg,
      sage-color(red, 200) 0,
      sage-color(red, 200) 12px,
      sage-color(white) 12px,
      sage-color(white) 24px
    );

    > * {
      visibility: hidden;
    }
  }

  &.sage-outline-item--depth-0 {
    // no-op
  }

  &.sage-outline-item--depth-1 {
    &:not(.sage-outline-item--category) {
      // no-op
    }
    &.sage-outline-item--category {
      margin-left: sage-spacing(lg);
    }
  }

  &.sage-outline-item--depth-2 {
    &:not(.sage-outline-item--category) {
      margin-left: sage-spacing(lg);
    }
    &.sage-outline-item--category {
      margin-left: sage-spacing(xl);
    }
  }
}

.sage-outline-item__title {
  grid-area: title;
  color: sage-color(charcoal, 400);
  @include truncate;

  .sage-outline-item--category & {
    @extend %t-sage-body-semi;
  }

  :not(.sage-outline-item--category) & {
    @extend %t-sage-body;
  }
}

.sage-outline-item__actions-secondary {
  display: flex;
  grid-area: actions-secondary;
  flex-direction: row;

  @media (min-width: sage-breakpoint($-collapse-breakpoint-key)) {
    display: none;
    visibility: hidden;

    :hover > &,
    :focus > &,
    :focus-within > & {
      display: flex;
      visibility: visible;
    }
  }
}

.sage-outline-item__actions-primary {
  grid-area: actions-primary;
}

.sage-outline-item__status {
  display: flex;
  grid-area: status;
  justify-content: flex-end;
  transform: none;
}

.sage-outline-item__handle-drag {
  grid-area: handle-drag;
  padding-left: sage-spacing(sm);
  cursor: grab;

  &:active {
    cursor: grabbing;
  }

  &::before {
    @include sage-icon-base(null);
    color: sage-color(charcoal, 200);
  }

  .sage-outline-item--category &::before {
    color: sage-color(primary);
  }

  .sage-outline-item:hover > & {
    &::before {
      content: sage-icon(handle);
      color: sage-color(charcoal, 100);
    }

    &:hover::before {
      color: sage-color(primary);
    }
  }
}

.sage-outline-item__handle-collapse {
  display: flex;
  grid-area: handle-collapse;
  justify-content: flex-end;
}

.sage-outline-item__children {
  .sage-outline-item--collapsed > & {
    display: none;
  }
}
